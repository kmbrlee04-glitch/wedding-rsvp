<!DOCTYPE html>
<html>
<head>
  <title>Wedding RSVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', sans-serif; max-width:500px; margin:auto; padding:20px; background:#fff8f0; color:#333; }
    h2{text-align:center;color:#a0522d;}
    p.description{text-align:center;background:#fff0e5;padding:10px;border-radius:8px;margin-bottom:20px;font-weight:bold;color:#8b4513;}
    input[type=text]{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;box-sizing:border-box;}
    button{width:48%;padding:12px;margin:5px 1%;border-radius:6px;border:none;font-weight:bold;cursor:pointer;}
    #confirmBtn{background:#a0522d;color:white;}
    #cannotAttendBtn{background:#ff6961;color:white;}
    #cancelBtn{background:#d3d3d3;color:#333;}
    #companions input[type=text]{margin-top:5px;}
    #companions label{display:block; margin:5px 0;}
    #suggestions div{padding:8px;border-bottom:1px solid #ddd;cursor:pointer;background:#fff8f0;}
    #suggestions div:hover{background:#ffe5d1;}
    .hidden{display:none;}
    @media(max-width:400px){button{width:100%;margin:5px 0;}}
  </style>
</head>
<body>

<h2>Wedding RSVP</h2>
<p class="description">
  Please search for your name to CONFIRM YOUR RSVP.<br>
  If you cannot find your name, please contact us directly.
</p>

<input type="text" id="guestName" placeholder="Enter your full name" oninput="showSuggestions()" />
<div id="suggestions"></div>

<div style="text-align:center;">
  <button id="confirmBtn" onclick="checkSeats()">CONFIRM RSVP</button>
  <button id="cannotAttendBtn" onclick="cannotAttend()">CANNOT ATTEND</button>
  <button id="cancelBtn" onclick="cancelRSVP()">CANCEL</button>
</div>

<p id="seatInfo"></p>

<div id="companions" class="hidden">
  <h3>Companion Names</h3>
  <div id="companionFields"></div>
  <div style="text-align:center;">
    <button onclick="submitRSVP()">CONFIRM RSVP</button>
    <button onclick="cannotAttend()">CANNOT ATTEND</button>
    <button onclick="cancelRSVP()">CANCEL</button>
  </div>
</div>

<script>
const WEB_APP_URL = "PASTE_YOUR_WEB_APP_URL_HERE"; // Replace with your Apps Script URL
let guestNames = [];
let seatCount = 0;

// Fetch guest names for auto-suggest
fetch(`${WEB_APP_URL}?list=true`).then(res=>res.json()).then(data=>guestNames=data);

// Auto-suggest
function showSuggestions(){
  const input = document.getElementById("guestName").value.toLowerCase();
  const box = document.getElementById("suggestions");
  box.innerHTML="";
  if(!input) return;
  guestNames.filter(n=>n.toLowerCase().includes(input)).slice(0,5).forEach(name=>{
    const div = document.createElement("div");
    div.textContent=name;
    div.onclick=()=>{document.getElementById("guestName").value=name;box.innerHTML="";};
    box.appendChild(div);
  });
}

// Check reserved seats
function checkSeats(){
  const name = document.getElementById("guestName").value;
  fetch(`${WEB_APP_URL}?name=${encodeURIComponent(name)}`)
    .then(res=>res.json())
    .then(data=>{
      if(!data.seats||data.seats==="Not found"){
        document.getElementById("seatInfo").innerText="Name not found. Please contact us.";
        return;
      }
      seatCount=data.seats;
      document.getElementById("seatInfo").innerText=`You have ${seatCount} reserved seat(s).`;

      let fields="";
      for(let i=1;i<seatCount;i++){
        fields+=`<label>Companion ${i}: <input type="text" placeholder="Name"> <input type="checkbox" checked> Will attend</label>`;
      }
      document.getElementById("companionFields").innerHTML=fields;
      document.getElementById("companions").classList.remove("hidden");
    });
}

// Submit RSVP
function submitRSVP(){
  const companionElements = document.querySelectorAll("#companionFields label");
  const companions=[];
  companionElements.forEach(l=>{
    const name=l.querySelector('input[type=text]').value.trim();
    const attend=l.querySelector('input[type=checkbox]').checked;
    if(name && attend) companions.push(name);
  });
  const mainGuest=document.getElementById("guestName").value.trim();
  if(!mainGuest){ alert("Enter your name!"); return; }
  fetch(WEB_APP_URL,{
    method:"POST",
    body:JSON.stringify({mainGuest:mainGuest,companions:companions,attending:true})
  }).then(()=>{alert("RSVP confirmed!"); location.reload();});
}

// Cannot attend
function cannotAttend(){
  const name=document.getElementById("guestName").value.trim();
  if(!name){ alert("Enter your name before submitting that you cannot attend."); return; }
  fetch(WEB_APP_URL,{
    method:"POST",
    body:JSON.stringify({mainGuest:name,companions:[],attending:false})
  }).then(()=>{alert("Recorded that you cannot attend."); location.reload();});
}

// Cancel/reset
function cancelRSVP(){
  document.getElementById("guestName").value="";
  document.getElementById("seatInfo").innerText="";
  document.getElementById("companions").classList.add("hidden");
  document.getElementById("companionFields").innerHTML="";
  document.getElementById("suggestions").innerHTML="";
}
</script>

</body>
</html>
